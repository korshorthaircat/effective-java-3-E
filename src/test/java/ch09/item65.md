# 65. 리플렉션보다는 인터페이스를 사용하라

> 리플렉션은 복잡한 특수 시스템 개발시 필요한 강력한 기능이지만, 단점도 많다.
> 컴파일 타임에는 알 수 없는 클래스를 사용하는 프로그램을 작성한다면 리플렉션을 사용해야 한다.
> 	단, 되도록 객체 생성에만 사용하고 생성한 객체를 이용할 때는 적절한 인터페이스나 컴파일 타임에 알 수 있는 상위 클래스로 형변환해 사용해야 한다.

- - -
## `java.lang.reflect`
### 리플렉션 기능
* 임의의 클래스에 접근하여, `Class`객체에서 `Constructor`, `Method`, `Field`인스턴스를 가져올 수 있고, 이 인스턴스들로부터 그 클래스의 멤버 이름, 필드 타입, 메서드 시그니처 등을 가져올 수 있따.
* `Constructor`, `Method`, `Field` 인스턴스에 연결된 실제 생성자, 메서드, 필드를 조작할 수 있다.
    * 예) `Method.invoke`로 메서드 호출 가능
* 컴파일 당시에 존재하지 않던 클래스도 이용할 수 있다.

### 리플렉션 사용이 필요한 상황
* 코드 분석 도구
* 의존관계 주입 프레임워크

## 리플렉션 사용시 유의
### 예) 리플렉션으로 인스턴스 생성 후 인터페이스로 참조해 활용하기
[ReflectiveInstantiation.java](..%2F..%2F..%2Fmain%2Fjava%2Fch09%2Fitem65%2FReflectiveInstantiation.java)
* 참고: [[Set 구현체 비교- HashSet, TreeSet, LinkedHashSet]]

### 리플렉션 사용시 단점
* (1) 컴파일 타임 타입 검사가 주는 이점을 누릴 수 없다.
    * 주의해서 사용하지 않으면 런타임시 오류 발생.
    * 위의 코드에서도, 인스턴스를 리플렉션 없이 생성했다면 컴파일타임에 모두 잡아낼 수 있는 예외임에도, 예외처리를 장황하게 해야 함
* (2) 코드가 지저분하고 장황해진다.
    * 위의 코드에서도, 인스턴스를 리플렉션 없이 생성했다면 생서자 호출 한 줄로 끝났을 일임.
    * 리플렉션 예외를 각각 잡는 대신 모든 리플렉션 예외의 상위 클래서 `ReflectiveOperationException`을 잡도록 하여 코드 길이를 줄일 수 있음
* (3) 성능이 떨어진다.
    * 일반 메서드 호출보다 리플렉션을 통한 메서드 호출이 훨씬 느리다.

##### 참고: 리플렉션을 활용한 Set 성능분석기
[SetPerformanceAnalyzer.java](..%2F..%2F..%2Fmain%2Fjava%2Fch09%2Fitem65%2FSetPerformanceAnalyzer.java)